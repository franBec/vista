# VISTA Roadmap

**Virtual Integrated System for Town Administration**

This document outlines the planned development tasks and milestones for the
VISTA project. It serves as a guide for tracking progress and setting future
goals.

## Initial Setup

- [x] Preference AI markdown file
  - It varies from AI to AI. In this project I'm using
    [qwen code](https://github.com/QwenLM/qwen-code/tree/main) just out of
    curiosity, and I have been satisfied by its answers most of the time
- [x] [MIT License](https://en.wikipedia.org/wiki/MIT_License)
- [x] [src Folder file convention](https://nextjs.org/docs/app/api-reference/file-conventions/src-folder)
- [x] [ESLint + Prettier Setup](https://github.com/danielalves96/eslint-prettier-next-15)
- [x] [shadcn/ui Components](https://ui.shadcn.com/)
  - [x] [Dark mode](https://ui.shadcn.com/docs/dark-mode/next)
  - [x] Customize theme (I use [tweakcn.com](https://tweakcn.com/) "Modern
        Minimal")
  - [x] Add shadcn generated files to `.prettierignore` and `eslint.config.mjs`
        `ignores` list
- [x] Landing page

## Navigation and Layout System

When navigating through distinct routes in the application, a consistent user
interface is crucial for creating a professional, easy-to-navigate application
that helps users understand where they are and how to find what they need.

### How It Fits With Next.js Routing

It's important to understand that creating a "Navigation and Layout System" is
NOT a replacement for Next.js as the main routing framework:

- The mapping of a URI to a `page.tsx` file remains Next.js's responsibility
  (always was and always will be)
- How a `page.tsx` file renders its content -> That's where our Navigation and
  Layout System comes in

Even with this system in place, as long as a `page.tsx` doesn't call the
"RoutePage" component, it's free to have a unique look and feel that's different
from the standard layout

This approach gives us the best of both worlds: Next.js handles the routing
mechanics while our system provides optional consistent layouts for pages that
need them.

- [x] Route configuration (`src/lib/routes.ts`)
  - Defines a hierarchical tree structure of routes, where each route contains
    metadata like its name, description, icon, URI, and whether it should appear
    in the sidebar, etc. (add as needed)
  - Defines utility functions that enable other components to query this route
    structure programmatically
- [x] Layout Component (`src/components/layout/route-page.tsx`)
  - Consumes the route data defined in `routes.ts`. The component automatically
    fetches route data based on the URI prop and renders the page with the
    correct header and potentially a grid of child routes if they exist
  - Provides several subcomponents (Header, Content, Grid, Auto, etc.) that
    allow you to build pages with consistent styling

## Layout Components

Create a consistent user interface across your entire application, providing
structural foundation for all pages.

- [x] Navigation Sidebar (`src/components/layout/app-sidebar.tsx`)
  - Reads the route information from your app's configuration and displays all
    available pages in a collapsible menu
- [x] Top Header (`src/components/layout/header.tsx`)
  - Top navigation bar. Contains the app logo/title, sidebar toggle button, dark
    mode control, etc. (add as needed)
- [x] Page Footer (`src/components/layout/footer.tsx`)
  - Bottom section of every page. Displays copyright information, contact
    details, and legal links, etc. (add as needed)
- [x] Root Layout (`src/app/layout.tsx`)
  - Main wrapper for your entire application. Sets up the overall page
    structure, applies fonts, includes theme support, and integrates user
    authentication

## Improve Developer Experience

- [x] Create the `dev` folder which will provide the instructions and files
      needed for setting up the development environment

### Vitest

- [x] In `vitest.config.mts` exclude testing:
  - Build/Generated directories
  - Config files
  - Infrastructure
  - Database
  - Next.js App Router
  - Files generated by shadcn/ui
- [x] Define testing approach
  - For React Components
  - For Typescript utilities

### Monitoring

Based on
[Debug & Monitor Next.js Apps with Grafana Loki, Prometheus, Zipkin](https://youtu.be/GW5Va_O-5uQ?si=2juNhv3_JHTs1FB-)

## Auth: Clerk Initial Setup

- [x] Follow Clerk "Next.js Quickstart (App Router)" -
      [Clerk Docs](https://clerk.com/docs/quickstarts/nextjs)
  - [x] Declare public routes (like "/" and others as needed)
- [x] Follow Clerk "Build your own sign-in-or-up page for your Next.js app with
      Clerk" -
      [Clerk Docs](https://clerk.com/docs/references/nextjs/custom-sign-in-or-up-page)
  - [x] Follow up with "Clerk Build your own sign-up page for your Next.js app
        with Clerk" -
        [Clerk Docs](https://clerk.com/docs/references/nextjs/custom-sign-up-page)
  - [x] Customize `src/app/sign-in/[[...sign-in]]/page.tsx` and
        `src/app/sign-up/[[...sign-up]]/page.tsx`
- [x] Create a private page
  - [x] For example: "/areas/personal"

## Database and ORM

- [x] Create a dev folder. In it create a `docker-compose.yaml` which will
      contain a postgres db and pgadmin4
  - [x] Configure a user with access limited to the public schema for the
        application to use
- [x] Create in dev folder a .env example
- [x] Indicate in `README.md` the existence of this folder
- [x] Define initial tables
  - [x] Save this `init.sql` in `dev/scripts`
- [x] Setup Drizzle

## Effect

- [ ] Setup Effect - [Effect Docs](https://effect.website/docs)
- [ ] Create in `src/backend/features/onboarding` a ports and adapters logic for
      onboarding a citizen (except front form, save info in database, update
      clerk metadata to indicate this citizen is now onboarded)
  - [ ] Setup error handling
- [ ] Unit testing
- [ ] Mutation testing

## Account Onboarding

- [ ] Follow Clerk "Add custom onboarding to your authentication flow" -
      [Clerk Docs](https://clerk.com/docs/references/nextjs/add-onboarding-flow)
- [ ] Create an onboarding form
  - [ ] Call the action previously defined
  - [ ] Redirect user to his personal area "/areas/personal"

## VPS Deployment

- [ ] Deploy this project to Coolify

## Citizen Proof of Identity

This is by no intent an automated proof thing. Is meant to be manual review by
an admin so it can avoid fake citizen profiles

- [ ] Improve the onboarding so now it asks for the citizen ID front and back
      photos
  - [ ] No idea where to save these photos. Considering doing file management in
        my own VPS (some kind of Coolify S3 clone) or using a third-party like
        UploadThing
- [ ] The citizen even though is onboarded, now is also in a state of "pending
      verification"
- [ ] Create the admin role
- [ ] Create an admin flow where it can manually approve or reject the citizen
      onboarding
  - [ ] If rejected, citizen can retry onboarding
  - [ ] If approved, flag of citizen verified is set

## Improve CI/CD Processes
